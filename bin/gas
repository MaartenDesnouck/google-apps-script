#!/usr/bin/env node

var package = require('../package.json');
var program = require('commander');
var path = require('path');
var lib = path.join(__dirname, '../lib');

program
    .version(package.version);

program
    .command('auth')
    .option('-f, --force', 'Force reauthentication')
    .option('-s, --show-url', 'Show the authentication url instead opening a webbrowser')
    .description('authenticate the Drive API (add \'-f\' to force reauthentication, add \'-s\' to show the authentication url instead opening a webbrowser) ')
    .action(require(lib + '/auth'));

program
    .command('clone <scriptTitle|scriptId>')
    .description('create a new local folder, link the remote script with the given scriptId and do a pull from remote')
    .action(require(lib + '/clone'));

program
    .command('config [path]')
    .option('-e, --export', 'Export a config file to the specified location')
    .option('-i, --import', 'Import a specified config file')
    .option('-r, --reset', 'Reset the config to default values')
    .description('configure gas to use .gs instad of .js or to use a custom OAuth client')
    .action(require(lib + '/config'));

program
    .command('create <scriptTitle>')
    .description('create a new script in your Google Drive')
    .action(require(lib + '/remote-create'));

program
    .command('delete <scriptTitle|scriptId>')
    .alias('remove')
    .description('delete a script from your Google Drive')
    .action(require(lib + '/remote-delete'));

program
    .command('deploy [scriptTitle|scriptId]')
    .option('-v, --versionNr <versionNr>', 'deploy a specific versionNumber')
    .option('-d, --description <description>', 'add a decription to the deployment')
    .description('deploy a new version of your Google Apps Script')
    .action(require(lib + '/deploy'));

program
    .command('deployments [scriptTitle|scriptId]')
    .description('show the deployements of the script linked to the current folder or about a specified script')
    .action(require(lib + '/deployments'));

program
    .command('include')
    .alias('i')
    .option('-s, --save <dependency>', 'save the specified dependency package in gas-include.json')
    .description('add included files specified in \'gas-include.json\'')
    .action(require(lib + '/include'));

program
    .command('init')
    .description('interactively configure a package.json')
    .action(require(lib + '/init'));

program
    .command('new <scriptTitle>')
    .description('create a new Google Apps Script in your Google Drive and then clone that script locally')
    .action(require(lib + '/new'));

program
    .command('link <scriptTitle|scriptId>')
    .description('link the remote script with the given scriptId to the current local folder')
    .action(require(lib + '/link'));

program
    .command('list [filter]')
    .description('list your remote standalone scripts and their id\'s (optional filter on scriptTitle)')
    .action(require(lib + '/list'));

program
    .command('open [scriptTitle|scriptId]')
    .description('open the script linked to the current folder or a specified script in the online editor')
    .action(require(lib + '/open'));

program
    .command('pull [fileName]')
    .description('pull code from your Google Drive, (add \'-i\' to also pull included files)')
    .action(require(lib + '/pull'));

program
    .command('publish')
    .description('publish a library to gas-include')
    .action(require(lib + '/publish'));

program
    .command('push [fileName]')
    .option('-d, --delete', 'Delete the specified file from the linked script on your Google Drive')
    .description('push your local code to the linked script on your Google Drive (add a fileName to only pull that file)')
    .action(require(lib + '/push'));

program
    .command('rename <scriptTitle|scriptId> <newScriptTitle>')
    .description('rename a script in your Google Drive')
    .action(require(lib + '/remote-rename'));

program
    .command('run [scriptTitle|scriptId]')
    .option('-f, --function <function>', 'run the specified function in the the script linked to the current folder or for a specified script')
    .description('run a function in your remote script')
    .action(require(lib + '/run'));

program
    .command('show [scriptTitle|scriptId]')
    .alias('info')
    .description('display info about the script linked to the current folder or about a specified script')
    .action(require(lib + '/show'));

program
    .command('status')
    .description('display the status of your local files')
    .action(require(lib + '/status'));

program
    .command('unlink')
    .description('unlink the remote script linked to the current folder')
    .action(require(lib + '/unlink'));

program
    .command('version [scriptId]')
    .option('-d, --description <description>', 'specify a description for the new version')
    .description('create a new fixed version for the script linked to the current folder or for a specified script')
    .action(require(lib + '/version'));

program
    .command('versions [scriptId]')
    .description('list the versions of the script linked to the current folder or of a specified script')
    .action(require(lib + '/versions'));


program
    .command('*')
    .action(function (argv) {
        console.log('\'gas %s\' is not a valid command use \'gas -h\' for help', argv);
        process.exit(2);
    });

program.on('--help', function () {
    console.log('');
    console.log('  Examples:');
    console.log('');
    console.log('    $ gas new myScript');
    console.log('    $ cd myScript');
    console.log('    $ gas open');
    console.log('');
    console.log('    $ gas list');
    console.log('    $ gas clone myScript');
    console.log('');
    console.log('    $ mkdir src');
    console.log('    $ cd src');
    console.log('    $ gas create myScript2');
    console.log('    $ gas link myScript');
    console.log('    $ gas info');
    console.log('    $ gas pull');
    console.log('');
});

program.parse(process.argv);

if (program.args.length < 1) {
    program.outputHelp();
    process.exit(2);
}
